<WelcomeScreen>:
    BoxLayout:
        orientation: 'vertical'
        Label:
            font_size: root.height/30
            text: ('[b]Welcome to the Rating App! [/b] \nPlease read the instructions carefully before proceeding.')
            markup: True
            size_hint_y: 0.15
        Label:
            text: 'Instructions follow here...'
            size_hint_y: 0.7
        BoxLayout:
            size_hint_y: 0.15
            Button:
                font_size: root.height/40
                text: 'Back'
                # This button does nothing for now, just a placeholder
                on_release: app.root.current = 'welcome'
                opacity: .5 # Make invisible as it's just a placeholder
            FocusableButton:
                id: btn_next
                font_size: root.height/40
                text: 'Next'
                on_release: app.root.current = 'login'


<LoginScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: 20
        spacing: 20

        Label:
            size_hint_y: 0.15
            text: ''

        Label:
            text: 'Have you already participated in this study and therefore used the app before?'
            font_size: root.height/35
            size_hint_y: 0.15
            halign: 'center'
            valign: 'middle'
            text_size: self.size

        BoxLayout:
            size_hint_y: 0.1
            spacing: 20
            padding: [100, 0, 100, 0]

            FocusableToggleButton:
                id: btn_participated_yes
                font_size: root.height/40
                text: 'Yes'
                group: "participation"
                on_state: root.participation_clicked(self, self.state, True)

            FocusableToggleButton:
                id: btn_participated_no
                font_size: root.height/40
                text: 'No'
                group: "participation"
                on_state: root.participation_clicked(self, self.state, False)

        # Message for new users (No selected)
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: 0.25
            opacity: 1 if root.has_participated == False else 0
            disabled: root.has_participated != False
            padding: [50, 20, 50, 20]

            Label:
                text: 'You will now be forwarded to the questionnaire, where you are asked some questions and your user id is being generated. Proceed?'
                font_size: root.height/45
                halign: 'center'
                valign: 'middle'
                text_size: self.size

        # User ID input for returning users (Yes selected)
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: 0.25
            opacity: 1 if root.has_participated == True else 0
            disabled: root.has_participated != True
            padding: [50, 20, 50, 20]
            spacing: 10

            Label:
                text: 'Please enter your user ID:'
                font_size: root.height/40
                size_hint_y: 0.3

            FocusableTextInput:
                id: input_user_id
                font_size: root.height/35
                hint_text: 'Enter your user ID'
                size_hint_y: 0.4
                multiline: False
                on_text: root.user_id_input_changed(self, self.text)

            Label:
                text: ('User ID found' if root.user_id_exists else ('User ID not found' if root.user_id_input else ''))
                font_size: root.height/45
                size_hint_y: 0.3
                color: (0, 0.8, 0, 1) if root.user_id_exists else (1, 0, 0, 1)

        Label:
            size_hint_y: 0.2
            text: ''

        BoxLayout:
            size_hint_y: 0.15
            spacing: 10
            FocusableButton:
                id: btn_back
                font_size: root.height/40
                text: 'Back'
                on_release: app.root.current = 'welcome'
            FocusableButton:
                id: btn_next
                font_size: root.height/40
                text: 'Next'
                on_release: root.proceed_next()


<QuestionnaireScreen>:
    BoxLayout:
        orientation: 'vertical'

        # Input Form Panel (shown when user_id not yet confirmed)
        BoxLayout:
            orientation: 'vertical'
            opacity: 1 if not root.user_id_confirmed else 0
            disabled: root.user_id_confirmed
            size_hint_y: 1 if not root.user_id_confirmed else None
            height: 0 if root.user_id_confirmed else self.parent.height

            Label:
                text: 'Please enter your information below.'
                font_size: root.height/40
                size_hint_y: 0.10
                height: '48dp'
            BoxLayout:
                size_hint_y: 0.10
                height: '48dp'

                Label:
                    font_size: root.height/40
                    text: 'Please select your gender'
                FocusableToggleButton:
                    id: gender_m
                    font_size: root.height/40
                    text: 'M'
                    group: "user_gender"
                    on_state: root.gender_clicked(self, self.state, "M")
                FocusableToggleButton:
                    id: gender_f
                    font_size: root.height/40
                    text: 'F'
                    group: "user_gender"
                    on_state: root.gender_clicked(self, self.state, "F")
                FocusableToggleButton:
                    id: gender_d
                    font_size: root.height/40
                    text: 'D'
                    group: "user_gender"
                    on_state: root.gender_clicked(self, self.state, "D")


            FocusableTextInput:
                id: input_age
                font_size: root.height/30
                hint_text: 'Enter your age'
                input_filter: 'int'
                size_hint_y: 0.10
                height: '48dp'
                on_text: root.age_input(self, self.text)
                multiline: False

            FocusableTextInput:
                id: input_player_exp
                font_size: root.height/30
                hint_text: 'Experience as a player (years)'
                input_filter: 'int'
                size_hint_y: 0.10
                height: '48dp'
                on_text: root.player_exp_input(self, self.text)
                multiline: False

            FocusableTextInput:
                id: input_coach_exp
                font_size: root.height/30
                hint_text: 'Experience as a coach (years)'
                input_filter: 'int'
                size_hint_y: 0.10
                height: '48dp'
                on_text: root.coach_exp_input(self, self.text)
                multiline: False

            FocusableTextInput:
                id: input_watch_exp
                font_size: root.height/30
                hint_text: 'Experience regularly watching soccer (years)'
                input_filter: 'int'
                size_hint_y: 0.10
                height: '48dp'
                on_text: root.watch_exp_input(self, self.text)
                multiline: False

            BoxLayout:
                size_hint_y: 0.10
                height: '48dp'
                Label:
                    font_size: root.height/40
                    text: 'Coaching License:'
                FocusableToggleButton:
                    id: license_none
                    font_size: root.height/40
                    text: 'None'
                    group: "user_license"
                    on_state: root.license_clicked(self, self.state, "None")
                FocusableToggleButton:
                    id: license_b
                    font_size: root.height/40
                    text: 'B'
                    group: "user_license"
                    on_state: root.license_clicked(self, self.state, "B")
                FocusableToggleButton:
                    id: license_a
                    font_size: root.height/40
                    text: 'A'
                    group: "user_license"
                    on_state: root.license_clicked(self, self.state, "A")
                FocusableToggleButton:
                    id: license_pro
                    font_size: root.height/40
                    text: 'Pro'
                    group: "user_license"
                    on_state: root.license_clicked(self, self.state, "Pro")


            FocusableTextInput:
                id: input_mother_initials
                font_size: root.height/30
                hint_text: "First two letters of mother's given name"
                size_hint_y: 0.10
                height: '48dp'
                max_length: 2
                on_text: root.mother_initials_input(self, self.text)
                multiline: False

            FocusableTextInput:
                id: input_father_initials
                font_size: root.height/30
                hint_text: "First two letters of father's given name"
                size_hint_y: 0.10
                height: '48dp'
                max_length: 2
                on_text: root.father_initials_input(self, self.text)
                multiline: False

            FocusableTextInput:
                id: input_siblings
                font_size: root.height/30
                hint_text: "Number of siblings"
                input_filter: 'int'
                size_hint_y: 0.10
                height: '48dp'
                on_text: root.siblings_input(self, self.text)
                multiline: False

            BoxLayout:
                size_hint_y: 0.10
                height: '48dp'
                spacing: 5
                Label:
                    font_size: root.height/40
                    text: 'Birthday:'
                    size_hint_x: 0.3
                FocusableTextInput:
                    id: input_birth_day
                    font_size: root.height/30
                    hint_text: 'Day'
                    input_filter: 'int'
                    on_text: root.birth_day_input(self, self.text)
                    multiline: False
                FocusableTextInput:
                    id: input_birth_month
                    font_size: root.height/30
                    hint_text: 'Month'
                    input_filter: 'int'
                    on_text: root.birth_month_input(self, self.text)
                    multiline: False
                FocusableTextInput:
                    id: input_birth_year
                    font_size: root.height/30
                    hint_text: 'Year'
                    input_filter: 'int'
                    on_text: root.birth_year_input(self, self.text)
                    multiline: False

            Label:
                size_hint_y: 0.25
                text: ''

            BoxLayout:
                size_hint_y: 0.15
                FocusableButton:
                    id: btn_back
                    font_size: root.height/40
                    text: 'Back'
                    on_release: app.root.current = 'login'
                FocusableButton:
                    id: btn_next
                    font_size: root.height/40
                    text: 'Next'
                    on_release: root.show_user_id_confirmation()

        # User ID Display Panel (shown after user_id is confirmed)
        BoxLayout:
            orientation: 'vertical'
            opacity: 1 if root.user_id_confirmed else 0
            disabled: not root.user_id_confirmed
            size_hint_y: 1 if root.user_id_confirmed else None
            height: 0 if not root.user_id_confirmed else self.parent.height
            padding: 50
            spacing: 30

            Label:
                size_hint_y: 0.3
                text: ''

            Label:
                text: 'This is your user id. Please memorize it. You will have to enter it when again opening the app.'
                font_size: root.height/50
                size_hint_y: 0.2
                halign: 'center'
                valign: 'middle'
                text_size: self.size

            Label:
                text: root.display_user_id
                font_size: root.height/20
                size_hint_y: 0.3
                bold: True
                halign: 'center'
                valign: 'middle'

            BoxLayout:
                size_hint_y: 0.2
                spacing: 10
                padding: [50, 0, 50, 0]

                FocusableButton:
                    id: btn_back_to_form
                    text: 'Back to User Data'
                    font_size: root.height/40
                    on_release: root.back_to_form()

                FocusableButton:
                    id: btn_proceed_video
                    text: 'Understood. Proceed'
                    font_size: root.height/40
                    on_release: root.proceed_to_video()

<ColoredLabel@Label>:
    canvas.before:
        Color:
            rgba: (100/255, 100/255, 100/255,1)
        Rectangle:
            pos: self.pos
            size: self.size
        Color:
            rgba: (0,0,0,1)
        Line:
            rectangle: self.x, self.y, self.width, self.height
            width: .8

<VideoPlayerScreen>:
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            size_hint_y: .1
            ColoredLabel:
                id: team_label
                font_size: root.height/40
                text: 'No Team'
                bold: True
            ColoredLabel:
                id: player_label
                font_size: root.height/40
                text: 'No Player'
                bold: True
            ColoredLabel:
                id: type_label
                font_size: root.height/40
                text: 'No Type'
                bold: True
            ColoredLabel:
                id: bodypart_label
                font_size: root.height/40
                text: 'No Bodypart'
                bold: True
            ColoredLabel:
                id: jerseynumber_label
                font_size: root.height/40
                text: 'No Jersey Number'
                bold: True
        BoxLayout:
            size_hint_y: .65
            orientation: 'horizontal'

            VideoPlayer:
                id: video_player
                size_hint_x: .65
                source: ''
                state: 'stop'
                options: {'eos': 'loop'}
                allow_stretch: True
            BoxLayout:
                size_hint_x: .35
                orientation: 'vertical'
                canvas.before:
                    Color:
                        rgba: (0, 0, 0, 1)  # Black background
                    Rectangle:
                        pos: self.pos
                        size: self.size
                BoxLayout:
                    id: plot_container
                    size_hint_y: None
                    height: self.parent.width * 0.67  # Maintain aspect ratio
                    orientation: 'vertical'
                Widget:
                    # Spacer to push plot to top
        Label:
            id: info_label
            size_hint_y: .05

        BoxLayout:
            size_hint_y: 0.1
            Button:
                size_hint_x: .25
                font_size: root.height/40
                text: 'Back to User Data'
                on_release: root.confirm_back_to_questionnaire()
            ToggleButton:
                id: btn_notrec
                font_size: root.height/40
                size_hint_x: .3
                text: 'Action not Recognized'
                on_state: root.action_not_recognized = (self.state == 'down')        
            Button:
                id: submit_button
                font_size: root.height/40
                size_hint_x: .4
                text: 'Submit Rating'
                disabled: (root.current_rating is None) and (not root.action_not_recognized)
                opacity: 1 if not self.disabled else .5
                on_release:
                    root.submit_rating()

        ########### Creativity Rating ###########
        BoxLayout:
            canvas.before:
                Color:
                    rgba: (100/255, 100/255, 100/255,1)
                Rectangle:
                    pos: self.pos
                    size: self.size
            size_hint_y: .12
            orientation: 'vertical'

            BoxLayout:
                size_hint_y: .4
                Label:
                    font_size: root.height/40
                    size_hint_x: None
                    text: 'Creativity Rating:'
                    width: dp(220)
                    halign: 'left'
                    text_size: self.size

            BoxLayout:
                size_hint_y: .4
                spacing: 6
                ToggleButton:
                    id: r_m3
                    text: '1'
                    group: 'likert7'
                    on_state: root.set_likert(1) if self.state == 'down' else None
                ToggleButton:
                    id: r_m2
                    text: '2'
                    group: 'likert7'
                    on_state: root.set_likert(2) if self.state == 'down' else None
                ToggleButton:
                    id: r_m1
                    text: '3'
                    group: 'likert7'
                    on_state: root.set_likert(3) if self.state == 'down' else None
                ToggleButton:
                    id: r_0
                    text: '4'
                    group: 'likert7'
                    on_state: root.set_likert(4) if self.state == 'down' else None
                ToggleButton:
                    id: r_p1
                    text: '5'
                    group: 'likert7'
                    on_state: root.set_likert(5) if self.state == 'down' else None
                ToggleButton:
                    id: r_p2
                    text: '6'
                    group: 'likert7'
                    on_state: root.set_likert(6) if self.state == 'down' else None
                ToggleButton:
                    id: r_p3
                    text: '7'
                    group: 'likert7'
                    on_state: root.set_likert(7) if self.state == 'down' else None

            BoxLayout:
                size_hint_y: .2
                Label:
                    text: 'not creative'
                Label:
                    text: ''
                Label:
                    text: ''
                Label:
                    text: ''
                Label:
                    text: ''
                Label:
                    text: ''
                Label:
                    text: 'very creative'

        ########## Technical Correctness Rating ##########
        BoxLayout:
            canvas.before:
                Color:
                    rgba: (100/255, 100/255, 100/255,1)
                Rectangle:
                    pos: self.pos
                    size: self.size
            size_hint_y: .12
            orientation: 'vertical'

            BoxLayout:
                size_hint_y: .4
                Label:
                    font_size: root.height/40
                    size_hint_x: None
                    text: 'Technical Correctness:'
                    width: dp(220)
                    halign: 'left'
                    text_size: self.size

            BoxLayout:
                size_hint_y: .4
                spacing: 6
                ToggleButton:
                    id: t_m3
                    text: '1'
                    group: 'likert7_tech'
                    on_state: root.set_likert_tech(1) if self.state == 'down' else None
                ToggleButton:
                    id: t_m2
                    text: '2'
                    group: 'likert7_tech'
                    on_state: root.set_likert_tech(2) if self.state == 'down' else None
                ToggleButton:
                    id: t_m1
                    text: '3'
                    group: 'likert7_tech'
                    on_state: root.set_likert_tech(3) if self.state == 'down' else None
                ToggleButton:
                    id: t_0
                    text: '4'
                    group: 'likert7_tech'
                    on_state: root.set_likert_tech(4) if self.state == 'down' else None
                ToggleButton:
                    id: t_p1
                    text: '5'
                    group: 'likert7_tech'
                    on_state: root.set_likert_tech(5) if self.state == 'down' else None
                ToggleButton:
                    id: t_p2
                    text: '6'
                    group: 'likert7_tech'
                    on_state: root.set_likert_tech(6) if self.state == 'down' else None
                ToggleButton:
                    id: t_p3
                    text: '7'
                    group: 'likert7_tech'
                    on_state: root.set_likert_tech(7) if self.state == 'down' else None
            BoxLayout:
                size_hint_y: .2
                Label:
                    text: 'very low'
                Label:
                    text: ''
                Label:
                    text: ''
                Label:
                    text: ''
                Label:
                    text: ''
                Label:
                    text: ''
                Label:
                    text: 'very high'

        ########## Aesthetic Appeal Rating ##########
        BoxLayout:
            canvas.before:
                Color:
                    rgba: (100/255, 100/255, 100/255,1)
                Rectangle:
                    pos: self.pos
                    size: self.size
            size_hint_y: .12
            orientation: 'vertical'

            BoxLayout:
                size_hint_y: .4
                Label:
                    font_size: root.height/40
                    size_hint_x: None
                    text: 'Aesthetic Appeal:'
                    width: dp(220)
                    halign: 'left'
                    text_size: self.size

            BoxLayout:
                size_hint_y: .4
                spacing: 6
                ToggleButton:
                    id: a_m3
                    text: '1'
                    group: 'likert7_aes'
                    on_state: root.set_likert_aesthetic(1) if self.state == 'down' else None
                ToggleButton:
                    id: a_m2
                    text: '2'
                    group: 'likert7_aes'
                    on_state: root.set_likert_aesthetic(2) if self.state == 'down' else None
                ToggleButton:
                    id: a_m1
                    text: '3'
                    group: 'likert7_aes'
                    on_state: root.set_likert_aesthetic(3) if self.state == 'down' else None
                ToggleButton:
                    id: a_0
                    text: '4'
                    group: 'likert7_aes'
                    on_state: root.set_likert_aesthetic(4) if self.state == 'down' else None
                ToggleButton:
                    id: a_p1
                    text: '5'
                    group: 'likert7_aes'
                    on_state: root.set_likert_aesthetic(5) if self.state == 'down' else None
                ToggleButton:
                    id: a_p2
                    text: '6'
                    group: 'likert7_aes'
                    on_state: root.set_likert_aesthetic(6) if self.state == 'down' else None
                ToggleButton:
                    id: a_p3
                    text: '7'
                    group: 'likert7_aes'
                    on_state: root.set_likert_aesthetic(7) if self.state == 'down' else None
            BoxLayout:
                size_hint_y: .2
                Label:
                    text: 'not appealing'
                Label:
                    text: ''
                Label:
                    text: ''
                Label:
                    text: ''
                Label:
                    text: ''
                Label:
                    text: ''
                Label:
                    text: 'very appealing'

